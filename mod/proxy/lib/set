# shellcheck shell=dash

# proxy set 127.0.0.1:7070
# proxy set 127.0.0.1:7070 ftp=ftp://127.0.0.1:7070

___x_cmd_proxy___inner_set(){
    local proxy="$2"

    case $proxy in
        https://*|http://*|socks*://*|ftp*://*)     ;;
        *)          
            proxy="http://$proxy"
            proxy:info "Considered as $proxy"
            ;;
    esac

    case "$1" in
        --http|http)   
            proxy:info "Set http_proxy HTTP_PROXY to $proxy"
            export http_proxy="$proxy"
            export HTTP_PROXY="$proxy"      ;;
        --https|https)
            proxy:info "Set https_proxy HTTPS_PROXY to $proxy"
            export https_proxy="$proxy"
            export HTTPS_PROXY="$proxy"     ;;
        --ftp|ftp)
            proxy:info "Set ftp_proxy FTP_PROXY to $proxy"
            export ftp_proxy="$proxy"
            export FTP_PROXY="$proxy"       ;;
        --all|all)
            proxy:info "Set all_proxy ALL_PROXY to $proxy"
            export all_proxy="$proxy"
            export ALL_PROXY="$proxy"       ;;

        --httpx)
            proxy:info "Set http_proxy HTTP_PROXY to $proxy"
            export http_proxy="$proxy"
            export HTTP_PROXY="$proxy"      
            export https_proxy="$proxy"
            export HTTPS_PROXY="$proxy"      ;;

        --adapt)
            proxy:info "Set adapt to $proxy"
            export http_proxy="$proxy"
            export HTTP_PROXY="$proxy"      
            export https_proxy="$proxy"
            export HTTPS_PROXY="$proxy"      
            export ftp_proxy="$proxy"
            export FTP_PROXY="$proxy"      
            proxy="socks5://${proxy#*://}"
            export all_proxy="$proxy"
            export ALL_PROXY="$proxy"       ;;
    esac
}


___x_cmd_proxy_set___handel(){
    local proxy
}

___x_cmd_proxy_set(){
    case "$1" in
        -h|--help)      x help -m proxy set >&2; return 1 ;;
    esac

    [ "$#" -gt 0 ] || { ___x_cmd_proxy_ls;  return; }

    local arg
    while [ "$#" -gt 0 ]; do
        arg="$1";           shift
        case "$arg" in 
            --)     break   ;;

            --http|--https|--all|--ftp|--httpx|--adapt)         
                    ___x_cmd_proxy___inner_set "$arg" "${1}";     
                    shift ;;

            http://*|https://*)
                    proxy:info "Considered as --httpx $arg"
                    ___x_cmd_proxy___inner_set --httpx "$1"
                    break   ;;

            socks*://*)
                    proxy:info "Considered as --all $arg"
                    ___x_cmd_proxy___inner_set --all "$1"
                    break   ;;

            *://*)   N=proxy M="Invalid proxy address => $1" log:ret:64 ;;

            *)  
                    proxy:info "Considered as --adapt $arg"
                    ___x_cmd_proxy___inner_set --adapt  "$arg"
                    break  ;;
        esac
    done

    [ $# -eq 0 ] || "$@"
}
