

# This will only invoked when xonsh is activate on interactive mode ...

if "$HOME/.x-cmd.root/bin" not in $PATH:
    $PATH.insert(0, '/home/scopatz/.x-cmd.root/bin')
    # $PATH.append('/home/scopatz/.x-cmd.root/bin')

if "$HOME/.x-cmd.root/global/data/bin/l/j/h/bin" not in $PATH:
    $PATH.insert(0, '/home/scopatz/.x-cmd.root/global/data/bin/l/j/h/bin')
    # $PATH.append('/home/scopatz/.x-cmd.root/global/data/bin/l/j/h/bin')


# xonsh defaults all variables exported
$___X_CMD_IS_INTERACTIVE_FORCE = 1
$___X_CMD_THEME_RELOAD_DISABLE = 1

$___X_CMD_CD_RELM_0 = $PWD

xbinexp = "$HOME/.x-cmd.root/bin/xbinexp"

import re
import os
import random

def ___x_cmd_xonsh_x(args):
    $___X_CMD_XBINEXP_FP = $HOME + "/.x-cmd.root/local/data/xbinexp/onsh/"  + str(os.getpid()) + "_" + str(random.randint(0,32767))
    # mkdir -p $___X_CMD_XBINEXP_FP

    $___X_CMD_XBINEXP_EVAL = ""
    $___X_CMD_XBINEXP_INITENV_OLDPWD = $OLDPWD

    # xbinexp @(args)
    if r := ![ xbinexp @(args) ] :
        ___exit_code = r.returncode
    else:
        ___exit_code = 1

    if not os.path.isdir( $___X_CMD_XBINEXP_FP ):
        return ___exit_code

    for posixfp in gp`$___X_CMD_XBINEXP_FP/*_*`:
        value = open(posixfp).read()
        name = re.sub(r"^[^_]*_", "", posixfp.name)
        if name == "PWD":
            cd @(value)
        else:
            ${...}[name] = value

    if "onsh" in $___X_CMD_XBINEXP_FP:
        # dangerous
        rm -rf "$___X_CMD_XBINEXP_FP"

    if "___X_CMD_XBINEXP_EVAL" in ${...} and $___X_CMD_XBINEXP_EVAL != "":
        evalx_cmd = $___X_CMD_XBINEXP_EVAL
        del ${...}["___X_CMD_XBINEXP_EVAL"]
        evalx( evalx_cmd )

    return ___exit_code

aliases['xbin'] = ___x_cmd_xonsh_x

aliases['x'] = "$HOME/.x-cmd.root/bin/xbinexp" # ___x_cmd_xonsh_x
aliases["xw"]   = [ "x", "ws" ]
aliases["xg"]   = [ "x", "git" ]

def ___x_cmd_xonsh_c(args):
    len_of_args = len(args)
    if len_of_args == 0:
        xbin cd
        return

    if len_of_args == 1:
        arg1 = args[0]
        if arg1 == "-":
            cd $OLDPWD
            return
        if arg1 == "~":
            cd ~
            return

        if os.path.isdir(arg1):
            cd @(arg1)
            return

    xbin cd @(args)

aliases['c'] = ___x_cmd_xonsh_c

def ___x_cmd_xonsh_agent_func( args ):
    $___X_CMD_CHAT_NORMAL_ALIAS = args[0]
    x chat "--send" @(args[1:])

aliases['___x_cmd_xonsh_agent'] = ___x_cmd_xonsh_agent_func

aliases['@o']           = [ "___x_cmd_xonsh_agent", "o" ]
aliases['@gemini']      = [ "___x_cmd_xonsh_agent", "gemini" ]
aliases['@kimi']        = [ "___x_cmd_xonsh_agent", "kimi" ]

aliases['@mistral']     = [ "___x_cmd_xonsh_agent", "mistral" ]

aliases['@gpt']         = [ "___x_cmd_xonsh_agent", "gpt" ]
aliases['@gpt3']        = [ "___x_cmd_xonsh_agent", "gpt3" ]
aliases['@gpt4']        = [ "___x_cmd_xonsh_agent", "gpt4" ]

aliases[',']            = [ "xbin", "onsh", "--sysco" ]

