# shellcheck shell=dash

___x_cmd_ollama_model_ls(){
    [ "$#" -gt 0 ] ||       set -- --all

    case "$1" in
        -a|--all)           shift; ___x_cmd_ollama_model_ls_all      "$@"  ;;
        -l|--local)         shift; ___x_cmd_ollama_ls_local                ;;
        -h|--help)          shift; x help -m ollama model ls               ;;
    esac

}

___x_cmd_ollama_model_ls_all(){
    [ $# -gt 0 ]    ||      set - --app
    local op="$1"
    local format=
    case "$op" in
        --csv)      format=csv       ;;
        --app)      format=app       ;;
        -h|--help)  x help -m ollama model ls  "$@"; return ;;
        *)          M="Not support $op" N=moonshot log:ret:1 ;;
    esac


    "___x_cmd_ollama_model_ls____all____${format}"
}

___x_cmd_ollama_model_ls____all____csv(){
    < "$___X_CMD_ROOT_MOD/ollama/lib/model/model.csv" ___x_cmd_cmds cat
}

___x_cmd_ollama_model_ls____all____app(){
    local data=; local x_=
    ___x_cmd_storeread_ < "$___X_CMD_ROOT_MOD/ollama/lib/model/model.csv" x csv --app --width "25%,25%,25%,25%" --return print
    data="$x_"

    if [ -n "$data" ] ; then
        local model="${data%%,*}"

        x ui select id "What to do NEXT" \
        "Download model: $model"         \
        "Delete model: $model"           \
        "EXIT"     || return

        case "$id" in
            1)  x ollama model download "$model"   ;;
            2)  x ollama rm   "$model"   ;;
            3)
                ollama:info "EXIT [code=0]"
                return 0 ;;
        esac
    fi
}

___x_cmd_ollama_ls_local(){
    ___x_cmd_ollama___bin list
}

