# shellcheck shell=dash
___x_cmd_llmf_serve(){
    [ "$#" -gt 0 ]      ||   set - --

    local host="" # "127.0.0.1"
    local port="" # "8080"
    local model=""
    local mmproj=""

    while [ $# -gt 0 ]; do
        case "$1" in
            -h|--help)
                x help -m llmf serve
                return 1
                ;;

            -m|--model)     [ "$#" -ge 2 ] || N=llmf M="Please provide --model <model name or model path>"  log:ret:64;
                            model="$2"  ;;
            --mmproj)       [ "$#" -ge 2 ] || N=llmf M="Please provide --mmproj <mmproj>"                   log:ret:64;
                            mmproj="$2" ;;
            -p|--port)      [ "$#" -ge 2 ] || N=llmf M="Please provide --port <port ~ [0-9]+>"              log:ret:64;
                            port="$2"   ;;
            --host)         [ "$#" -ge 2 ] || N=llmf M="Please provide --host <host>"                       log:ret:64;
                            host="$2"   ;;

            --)             shift;          break ;;
            *)              break ;;
        esac
        shift 2
    done

    llmf:prepare:model:mmproj
    [ -z "$model" ]  || set -- "$@" --model "$model"
    [ -z "$mmproj" ] || set -- "$@" --mmproj "$mmproj"
    [ -z "$host" ]   || set -- "$@" --host "$host"
    [ -z "$port" ]   || set -- "$@" --port "$port"

    # --nobrowser
    llmf:debug --cmd "x cosmo llamafile --server $*"
    ___x_cmd cosmo llamafile --server "$@"
}


___x_cmd_llmf_serve___exec(){
    local model="$1";    shift
    ___x_cmd_llmf___exec "$model" --server "$@"
}
