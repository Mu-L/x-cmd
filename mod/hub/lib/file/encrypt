# shellcheck shell=dash

___x_cmd_hub_file___encrypt_file(){
    local filekey_path="${1:? filekey path is required}"
    hub:debug "encrypt file => filekey_path=$filekey_path"
    x openssl rand -hex 32 > "$filekey_path" || return 1
    x openssl enc -aes-256-cbc -salt -in - -out - -pbkdf2 -pass file:"$filekey_path"
    # TODO: use 7z/xz to compress file
}

___x_cmd_hub_file___decrypt_file(){
    local filekey_path="${1:? filekey path is required}"
    hub:debug "decrypt file => filekey_path=$filekey_path"
    x openssl enc -d -aes-256-cbc -in -  -pbkdf2 -out - -pass file:"$filekey_path"
}

___x_cmd_hub_file___encrypt_filekey(){
    local keypath="${1:? public_key path is required}"
    # maybe some problem at pkg, if use pkg at one pipeline, it will cause error
    # TODO: oneline output use openssl
    x openssl pkeyutl -encrypt -pubin -inkey "$keypath" -in - -out - | x openssl enc -A -base64
}

___x_cmd_hub_file___decrypt_filekey(){
    local keypath="${1:? private_key name}"
    x openssl enc -d -A -base64 | x openssl pkeyutl -decrypt -inkey "$keypath" -in - -out -
}
