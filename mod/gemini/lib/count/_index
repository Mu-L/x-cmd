# shellcheck shell=dash disable=SC2034

___x_cmd_gemini_count_request___try(){
    gemini:debug "Sending request to gemini server"
    requestbody="$(printf "%s\n" "$requestbody" | x jo .contents)"
    requestbody="{\"contents\": $requestbody}"
    [ -z "$confirm_before_send" ] || {
        printf "%s\n" "$requestbody" | x j2y | x bat -l yml
        x ui yesno "Do your want to send this message?" || return 0
    }

    ___x_cmd_gemini_request_count "$requestbody" "$model" | \
    {
        local interative=
        if ___x_cmd_is_interactive; then interative=1; fi

        local errcode=0
        x cawk  -m j/json,j/jiter,j/jcp                                      \
                -f "$___X_CMD_ROOT_MOD/gemini/lib/count/count_response.awk" || errcode=$?

        return "$errcode"
    }
}