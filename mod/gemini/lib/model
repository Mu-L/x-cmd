# shellcheck shell=dash

___x_cmd_gemini_model(){
    [ $# -gt 0 ]    ||  set - ls

    local op="$1";      shift
    case "$op" in
        ls|ll|set|get)          ___x_cmd_gemini_model_"$op" "$@"            ;;
        -h|--help)              ___x_cmd help -m gemini model               ;;
        *)                      ___x_cmd help -m gemini model >&2; return 1 ;;
    esac
}

___x_cmd_gemini_model_ll(){
    ___x_cmd_gemini_request_ll "$@" | x j2y
}


___x_cmd_gemini_model_ls(){
    [ $# -gt 0 ]    ||  set - --app

    local op="$1";      shift
    case "$op" in
        --app|--csv|--json)
                        ___x_cmd_gemini_model_ls_"${op#*--}" "$@" ;;
        -h|--help)      ___x_cmd help -m gemini model ;;
    esac
}

___x_cmd_gemini_model_ls_app(){
    ___x_cmd_gemini_model_ls_csv | ___x_cmd csv app --return print
}

___x_cmd_gemini_model_ls_csv(){
    ___x_cmd_gemini_request_ls | x jo .models | x jo 2c .name .description .supportedGenerationMethods  .inputTokenLimit .outputTokenLimit .temperature .topP .topK  \
                               | ___x_cmd csv awk '{
                                    method = juq(cval(3))
                                    len = split(method,arr,",")
                                    str= ""
                                    for(i=1; i<=len;++i){
                                        if(i < len) str = str juq(arr[i]) ","
                                        else        str = str juq(arr[i])
                                    }
                                    print substr(cval(1),index(cval(1),"/")+1)"," jqu(cval(2))","jqu(str)"," jqu(cval(4))","jqu(cval(5))","jqu(cval(6))","jqu(cval(7))","jqu(cval(8))}' \
                               | ___x_cmd csv header      --add Name  Description SupportedGenerationMethods inputTokenLimit outputTokenLimit temperature topP topK
}

___x_cmd_gemini_model_ls_json(){
    ___x_cmd_gemini_request_ls
}


___x_cmd_gemini_model_get(){
    ___x_cmd_gemini_cur model:=  2>/dev/null
    printf "%s\n" "$model"
}


___x_cmd_gemini_model_set(){
    local model="$1"
    x gemini --cfg set model="$model"
}