# shellcheck shell=dash

# https://ai.google.dev/api/rest/v1beta/models/countTokens?hl=zh-cn
___x_cmd_gemini_request_count(){
    local content="$1"
    local model="$2"        # optional
    local apikey=
    local proxy=

    ___x_cmd_gemini_cur     apikey:=    model:=     proxy:=     2>/dev/null
    model="${model:-gemini-pro}"

    gemini:debug --content "$content" "Sending request [model=$model] [proxy=$proxy]"

    x curl  -s \
        ${proxy:+-x} ${proxy:+"$proxy"}                 \
        -H 'Content-Type: application/json' \
        -d  "$content"                      \
        "${___X_CMD_GEMINI_ENDPOINT}/v1beta/models/${model}:countTokens?key=${apikey}"
}

