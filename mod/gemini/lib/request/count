# shellcheck shell=dash

# https://ai.google.dev/api/rest/v1beta/models/countTokens?hl=zh-cn
___x_cmd_gemini_counttokens(){
    local content="$1"
    local model="$2"
    local apikey
    ___x_cmd_gemini_cur     apikey:=    model:= 2>/dev/null
    model="${model:-gemini-pro}"

    [ -n "$apikey" ] || {
        gemini:error "Please setting up your apikey first ==> 'x gemini --cfg apikey=<your apikey>'"
        return 1
    }

    local data='
{
  "contents": [
    {
      "parts": [ { "text": '"\"$content\""' } ]
    }
  ]
}'

    x curl \
        -H 'Content-Type: application/json' \
        -d "$data" \
        "${___X_CMD_GEMINI_ENDPOINT}/v1beta/models/$model:countTokens?key=${apikey}"
}
