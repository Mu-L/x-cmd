# shellcheck shell=bash

___x_cmd_shodan_trend_search(){
    [ $# -gt 0 ] ||         set -- -h

    local op="$1";          shift
    case "$op" in
        -h|--help)          x help -m shodan trend search ;;

        filter|filters)     ___x_cmd_shodan_trend_search_filter ;;
        facet|facets)       ___x_cmd_shodan_trend_search_facet ;;

        --)                 ___x_cmd_shodan_trend_search___main        "$@" ;;
        *)                  ___x_cmd_shodan_trend_search___main "$op"  "$@" ;;
    esac
}

___x_cmd_shodan_trend_search___main(){
    local query="$1"
    local facet="$2"

    [ -n "$query" ] ||  N=shodan M="Required query" log:ret:64

    if ! ___x_cmd_shodan_is_interactive_env; then
        ___x_cmd_shodan_trend_search___curl
        return
    fi

    ___x_cmd_shodan_trend_search___curl | x j2y
}

___x_cmd_shodan_trend_search___curl(){
    # X_CCMD_TIMEOUT=10m  \
    ___X_CMD_SHODAN_API_URL=https://trends.shodan.io    \
        ___x_cmd_shodan_trend_search___inner
}

___x_cmd_shodan_trend_search___inner(){
    set -- "/api/v1/search" -d "query=$query"
    [ -z "$facet" ] || set -- "$@" -d "facets=$facet"
    ___x_cmd_shodan_curl_get "$@"
}
