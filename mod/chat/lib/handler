# shellcheck shell=dash

___x_cmd_chat_handler___stream_to_print(){
    x cawk -m j/json,j/jiter \
        -f "$___X_CMD_ROOT_MOD/chat/lib/awk/stream_to_print.awk"
}

# TODO: use yml y2j
___x_cmd_chat_handler___get_history_record(){
    local dir="$1"
    local history="$2"
    [ -d "$dir" ] || return
    local file
    x fsiter "$dir" | sort -r | while read -r file; do
        < "$dir/$file" x y2j
    done | history="$history" x cawk -m j/json,j/jiter \
        -f "$___X_CMD_ROOT_MOD/chat/lib/awk/get_history_record.awk"
}
