
# function:

# u|update
# l|ls
# i|info


___x_cmd_install_nv(){
    { [ -t 1 ] && ___x_cmd_is_interactive; } \
        || N=install M="Software name required" log:ret:64

    install:info "opening navigator → x install nv"

    local software
    software="$(___x_cmd_install_ls___raw | x pick --col 4)"
    [ -n "$software" ] || {
        # N=install M="Can not find data" log:ret:1
        install:info "Exit because no software is selected."
        # install:info "If you want to dump the list of all software to stdout, try: x install ls | cat"
        return 0
    }
    local homepage
    homepage="$(___x_cmd_install_get_homepage "$software")"

    if ! x os is darwin &&  ___x_cmd_hascmd apt;    then
        ___x_cmd_install___next_main 'x apt     # list all apt avaiable packages '
    elif    ___x_cmd_hascmd dnf;    then
        ___x_cmd_install___next_main 'x dnf     # list all dnf avaiable packages '
    elif    ___x_cmd_hascmd apk;    then
        ___x_cmd_install___next_main 'x apk     # list all apk avaiable packages '
    elif    ___x_cmd_hascmd brew;   then
        ___x_cmd_install___next_main 'x brew    # list all brew avaiable packages '
    elif ___x_cmd_install___env_available; then
        ___x_cmd_install___next_main 'x scoop   # list all scoop avaiable packages '
    else
        ___x_cmd_install___next_main
    fi
}

# search app in apt/brew/dnf
___x_cmd_install___next_main(){
    local id
    x ui select id "What to do NEXT"                        \
        "x install $software"                               \
        "x open $homepage"                                  \
        "$@"                                                \
        "EXIT"     || return
        # "Visit the official website of $software"   \

    case "$id" in
        1)
            install:info "Install software → x install $software"
            x install --run "$software" ;;
        2)
            install:info "Goto website → x open $homepage"
            x open "$homepage"          ;;
        # 3)          x open "https://x-cmd.com/install/$software" ;;     # TODO
        *)
            if [ "$((id-3))" -ge $# ]; then
                install:info "EXIT [code=0]"
            else
                local cmd; eval "cmd=\"\$$((id-2))\""
                install:info "Command → $cmd"
                eval  "$cmd"
            fi
            ;;
    esac
}


