# shellcheck shell=dash

___x_cmd_scoop___install(){
    if [ "$___X_CMD_WEBSRC_REGION" = "cn"  ]; then
        x pwsh <"$___X_CMD_ROOT_MOD/scoop/lib/install_cn.ps1"
    else
        x pwsh <"$___X_CMD_ROOT_MOD/scoop/lib/install.ps1"
    fi
}


___x_cmd_scoop_install(){

     if [ "$#" -eq 0 ]; then
        ___x_cmd_scoop___nv
        return 0
    fi

    local name="$1"
    x scoop info "${name}" | ___x_cmd_cmds_awk 'NR==6{print "\033[32m"$0"\033[0m" >"/dev/stderr"};NR==7{print "\033[32m"$0"\033[0m" >"/dev/stderr" ; exit(1)} END{exit(0)}' || M="Not found ${name} in current bucket" N=scoop log:ret:1
    ___x_cmd_scoop___bin "install" "$name"
}

___x_cmd_scoop___lsraw(){
    x ccmd 1d -- ___x_cmd_cmds scoop search | ___x_cmd_cmds awk 'NR>4{print $1}'
}

___x_cmd_scoop___nv(){
    { [ -t 1 ] && ___x_cmd_is_interactive; } \
        || {
            ___x_cmd_scoop___lsraw
            return 0
        }

    local software=
    software="$(___x_cmd_scoop___lsraw | x pick --width 40 --col 10)" \
        || {
            install:info "Exit because no software is selected."
            return 0
        }

    [ -n "$software" ] || return 1
    local id=
    x ui select id "What to do NEXT"                        \
        "x scoop install $software"                         \
        "x scoop info $software"                            \
        "EXIT"     || return

    case "$id" in
        1)      ___x_cmd_scoop_install "$software" ;;
        2)      x scoop info "$software"   ;;
        3)      return 0 ;;

    esac

}

